# Plan — A Roadmap Item as a First-Class Entity
#
# Extends commitment. A plan is a feature, initiative, or roadmap
# item — a commitment with dependency relationships. Plans live in
# .ROADMAP/*.md files and are ingested by the roadmap migration skill.
#
# Status is computed from location and dependencies:
#   done    — file is in .ROADMAP/.archived/ (data.archived: true)
#   blocked — has unresolved blocked_by dependencies
#   ready   — no blocking dependencies
#
# Dependencies reuse the enables relationship (same as task blockers):
#   plan_a → enables → plan_b means plan_b is blocked_by plan_a
#
# in_repository is stored as data.repository (slug) for v1.
# Upgrade to a full graph relationship when traversal is needed.

id: plan
plural: plans
name: Plan
extends: commitment
description: A feature, initiative, or roadmap item — a commitment with dependencies

properties:
  priority:
    type: string
    enum: [now, high]
    description: Urgency level — how soon should this be worked on?

  content:
    type: string
    description: Full markdown body of the plan spec (FTS-indexed)

  started_at:
    type: datetime
    description: When work on this plan began

  data:
    type: object
    description: |
      Source file metadata:
        repository: Repository slug (e.g., "agentos", "agentos-community")
        filepath:   Absolute path to the source .md file
        archived:   true if file lives in .ROADMAP/.archived/

computed:
  status: |
    if .data.archived then "done"
    elif (.blocked_by | length > 0) and (.blocked_by | any(.status != "done")) then "blocked"
    else "ready"
    end

computed_relationships:
  blocked_by:
    type: enables
    direction: incoming
    fields: [status, name, priority]
  blocks:
    type: enables
    direction: outgoing
    fields: [status, name, priority]

identifiers: [id, name]
operations: [list, get, create, update, archive, search]

display:
  primary: name
  secondary: priority
  icon: map
  sort:
    - field: priority
      order: asc
    - field: status
      order: asc
    - field: name
      order: asc
