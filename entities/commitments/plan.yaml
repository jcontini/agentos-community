# Plan — A Roadmap Item as a First-Class Entity
#
# Extends commitment. A plan is a feature, initiative, or roadmap
# item — a commitment with dependency relationships.
#
# Status is computed from data and the enables graph:
#   done    — done: true (explicitly marked complete)
#   blocked — has incoming enables relationships where the blocker is not done
#   ready   — no blocking dependencies
#
# Dependencies use the enables relationship:
#   plan_a → enables → plan_b means plan_b cannot start until plan_a is done
#
# in_repository is stored as data.repository (slug) for v1.

id: plan
plural: plans
name: Plan
extends: commitment
description: A feature, initiative, or roadmap item — a commitment with dependencies

properties:
  priority:
    type: string
    enum: [now, high]
    description: Urgency level — how soon should this be worked on?

  content:
    type: string
    description: Full markdown body of the plan spec (FTS-indexed)

  started_at:
    type: datetime
    description: When work on this plan began

  done:
    type: boolean
    description: True when this plan has been completed

  data:
    type: object
    description: |
      Source metadata:
        repository: Repository slug (e.g., "agentos", "agentos-community")

computed:
  status: |
    if .done then "done"
    elif (.blocked_by | length > 0) and (.blocked_by | any(.done != true)) then "blocked"
    else "ready"
    end

computed_relationships:
  blocked_by:
    type: enables
    direction: incoming
    fields: [done, name, service_id]
  blocks:
    type: enables
    direction: outgoing
    fields: [done, name, service_id]

identifiers: [id, name]
operations: [list, get, create, update, archive, search]

display:
  primary: name
  secondary: priority
  icon: map
  sort:
    - field: priority
      order: asc
    - field: status
      order: asc
    - field: name
      order: asc
