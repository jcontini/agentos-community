# Session entity — a connection to AgentOS
#
# A session represents a live connection from an AI client (MCP stdio),
# a browser (HTTP cookie), or a future Streamable HTTP client. It is
# the ambient identity for all requests — templates, tools, and routes
# resolve the current session automatically.
#
# Sessions are created at connection time:
#   - MCP stdio: created after initialize + roots/list
#   - HTTP browser: created on first visit with a startup token (Jupyter model)
#   - Future Streamable HTTP: created during initialize, ID in Mcp-Session-Id header
#
# The session entity carries workspace and git context so templates can
# render project-scoped content without explicit parameters.
#
# Extends conversation because sessions contain messages (tool calls,
# responses) and are searchable, observable, and timeline-visible.

id: session
plural: sessions
extends: conversation
name: Session
description: A connection to AgentOS — MCP, HTTP, or Streamable HTTP

properties:
  # Connection identity
  client:
    type: string
    required: true
    description: Client identifier (e.g., "opencode", "cursor", "browser")

  client_version:
    type: string
    description: Client software version

  transport:
    type: string
    enum: [stdio, http, streamable_http]
    default: stdio
    description: How the client is connected

  # Client skill (resolved at session creation via case-insensitive match)
  client_skill:
    type: string
    description: Skill ID that corresponds to this client (e.g., "opencode", "cursor")

  # Workspace context
  workspace:
    type: string
    description: Absolute path to the workspace directory

  # Git context (detected from workspace at session creation)
  git_remote:
    type: string
    description: Git remote URL (e.g., "git@github.com:adavia-com/marketing.git")

  git_branch:
    type: string
    description: Current git branch

  git_org:
    type: string
    description: GitHub/GitLab org or user (e.g., "adavia-com")

  git_repo:
    type: string
    description: Repository name (e.g., "marketing")

  # Project identity (derived from git or workspace)
  project_id:
    type: string
    description: Canonical project identifier (e.g., "adavia-com/marketing")

  # Lifecycle
  status:
    type: string
    enum: [active, ended]
    default: active
    description: Whether the session is currently active

  ended_at:
    type: datetime
    description: When the session ended (detected via MCP disconnect or timeout)

operations: [list, get, create, update]

display:
  primary: name
  secondary: client
  icon: terminal
